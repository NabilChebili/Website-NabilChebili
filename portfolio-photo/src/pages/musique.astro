---
import "../styles/global.css";
import "../styles/layout.css";
import "../styles/index.css";
import "../styles/musique.css";
import Layout from "../layouts/header.astro";
	const videos = [
	  // premi√®re vid√©o fournie (embed)
	  "https://www.youtube.com/watch?v=6gsqAnGUTvw",
	  // autre vid√©o (embed)
	];

---

<Layout>
	<main class="page">
		<h1 class="page-title fade-in">Musique</h1>

		<p class="paragraph-center fade-in">
			Cette page est d√©di√©e √† ma passion pour la musique, en particulier la guitare.
		</p>

		<section class="section two-col">
			<div class="container two-col-inner fade-in">
				<div class="content">
					<p class="paragraph-center narrow">
						J‚Äôai commenc√© la guitare presque par hasard, en apprenant le riff de <em>Come As You Are</em> lors d‚Äôun voyage. 
						Ce moment simple a √©t√© un d√©clic. 
						De retour chez moi, j‚Äôai d√©couvert quelques accords sur Internet et je me suis mis √† m‚Äôentra√Æner r√©guli√®rement pour reproduire des chansons que j‚Äôaimais.
					<br><br>
					</p>
					<p class="paragraph-center narrow">
						Peu √† peu, la guitare a pris une place dans mon quotidien. 
						Elle m‚Äôa appris √† √©couter autrement, √† reproduire ce que j‚Äôentendais, puis √† laisser venir mes propres id√©es. 
						Avec le temps, j‚Äôy ai trouv√© une vraie satisfaction : progresser par √©tapes, avec patience.
					</p>
				</div>
				<div class="media">
					<img src="image.png" alt="Guitare" />
				</div>
			</div>
		</section>

		<section class="section fade-in">
			<div class="container">
				<h2 style="margin-bottom:12px;">Carrousel de vid√©os</h2>

				<div class="video-carousel" aria-label="Carrousel vid√©o">
					<button class="car-btn prev" aria-label="Pr√©c√©dent">‚Äπ</button>
					<div class="carousel-track" role="list">
						{videos.map((src) => {
							const id = src.includes('v=') ? src.split('v=')[1].split('&')[0] : src.split('/').pop();
							return (
								<div class="carousel-item" role="listitem">
									<iframe
										width="200"
										height="315"
										src={`https://www.youtube-nocookie.com/embed/${id}`}
										title="YouTube video player"
										frameborder="0"
										allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
										referrerpolicy="strict-origin-when-cross-origin" 
										allowfullscreen
									></iframe>
								</div>
							);
						})}
					</div>
					<button class="car-btn next" aria-label="Suivant">‚Ä∫</button>
				</div>

				<p class="paragraph-center">Utilisez les fl√®ches ou le clavier (‚Üê ‚Üí) pour naviguer. Sur mobile, balayez la zone.</p>
			</div>
		</section>

		<section class="section two-col">
			<div class="tab-card fade-in">
				<div class="tab-card-media" aria-hidden="true">üé∏</div>
				<div class="tab-card-body">
					<h3>Tablatures</h3>
					<p class="muted">Envie de jouer ces morceaux ? J'ai rassembl√© des tablatures simplifi√©es pour commencer rapidement.</p>
					<a class="tab-btn" href="https://docs.google.com/document/d/1lzav6pmo0A10RGYKqbtwUIGk8aWnmJpQV9uYpebnV2Q/edit?usp=sharing" target="_blank" rel="noopener noreferrer">Acc√©der aux tablatures</a>
				</div>
			</div>
		</section>

		<script>
			(function () {
				// reveal animations (existing behavior)
				const nodes = Array.from(document.querySelectorAll('main .fade-in'));
				if (nodes.length) {
					const list = nodes
						.map((el) => ({ el, top: el.getBoundingClientRect().top + window.scrollY }))
						.sort((a, b) => a.top - b.top)
						.map((o) => o.el);
					const baseDelay = 80;
					const step = 120;
					list.forEach((el, i) => setTimeout(() => el.classList.add('is-visible'), baseDelay + i * step));
				}

				// Carousel logic (use native horizontal scroll + CSS scroll-snap)
				const carousel = document.querySelector('.video-carousel');
				if (!carousel) return;
				const track = carousel.querySelector('.carousel-track');
				let items = Array.from(track.querySelectorAll('.carousel-item'));
				const prev = carousel.querySelector('.car-btn.prev');
				const next = carousel.querySelector('.car-btn.next');
				let index = 0;

				function clamp(i) { return Math.max(0, Math.min(i, items.length - 1)); }

				function scrollToIndex(i) {
					const w = carousel.getBoundingClientRect().width;
					track.scrollTo({ left: i * w, behavior: 'smooth' });
					index = clamp(i);
				}

				prev.addEventListener('click', () => { scrollToIndex(index - 1); });
				next.addEventListener('click', () => { scrollToIndex(index + 1); });

				// keyboard navigation
				document.addEventListener('keydown', (e) => {
					if (e.key === 'ArrowLeft') scrollToIndex(index - 1);
					if (e.key === 'ArrowRight') scrollToIndex(index + 1);
				});

				// update index on native scroll end (debounced)
				let scrollTimer = null;
				track.addEventListener('scroll', () => {
					if (scrollTimer) clearTimeout(scrollTimer);
					scrollTimer = setTimeout(() => {
						const w = carousel.getBoundingClientRect().width;
						index = Math.round(track.scrollLeft / w);
					}, 120);
				});

				// make carousel responsive: set items width to carousel width (use inline-block sizing)
				function resize() {
					const w = carousel.getBoundingClientRect().width;
					items = Array.from(track.querySelectorAll('.carousel-item'));
					items.forEach((it) => { it.style.width = w + 'px'; });
					scrollToIndex(index);
				}
				window.addEventListener('resize', resize);
				resize();
			})();
		</script>
	</main>
</Layout>
